# Virall Nextflow run configuration
# Copy this file, fill in your paths and options, then run:
#   nextflow run nextflow/main.nf -params-file run_params.yaml -profile docker (or -profile singularity)
# Optional: -resume to continue from last successful step

# -----------------------------------------------------------------------------
# Input
# -----------------------------------------------------------------------------
# Path to sample sheet CSV
# Bulk mode columns: sample_id, read1, read2, single, long
# Single-cell mode columns: sample_id, sc_read1, sc_read2
samples: "nextflow/samples.csv"

# Output directory for all results
outdir: "/full/path/to/output/directory/"

# -----------------------------------------------------------------------------
# Databases (required for full pipeline; or set env VIRALL_DATABASE_DIR)
# -----------------------------------------------------------------------------
# Leave null to use VIRALL_DATABASE_DIR/kaiju_db, etc. for Docker and Singularity uses
kaiju_db: null
checkv_db: null      # CheckV database (optimal for bacteriophages)
genomad_db: null     # geNomad database (optimal for RNA viruses & eukaryotic viruses)
vog_db: null

# Quality assessment strategy:
# - CheckV is used for bacteriophages (Caudovirales, etc.) - excellent phage-specific database
# - geNomad is used for RNA viruses and eukaryotic viruses - better general coverage
# Results are automatically merged based on Kaiju taxonomy classification

# -----------------------------------------------------------------------------
# Assembly and mode
# -----------------------------------------------------------------------------
# Assembly strategy: "auto" (detect from inputs) | "hybrid" | "short_only" | "long_only"
# With "auto" (default): only paired/single → short_only; only long → long_only; both → hybrid
assembly_strategy: "auto"

# Set true for RNA-seq (SPAdes --rnaviral)
rna_mode: false

# Optional reference genome (e.g. viral reference FASTA)
# When set: 1) SPAdes uses --trusted-contigs for reference-guided assembly
#              (automatically overrides --rnaviral / --metaviral since those are incompatible)
#           2) REFERENCE_CHECK process runs to detect if reference is present in sample
#              (maps reads to reference, reports detection status, generates coverage plot)
reference: null

# Reference-only mode: skip de novo assembly (SPAdes/Flye), use reference-guided consensus only
# When true (requires 'reference' above), the pipeline:
#   - Aligns reads to reference (bwa for short, minimap2 for long)
#   - Generates polished consensus (medaka for Nanopore, samtools consensus otherwise)
#   - Feeds consensus contigs into the full downstream pipeline (KAIJU, CheckV, annotation, etc.)
# Much faster than de novo assembly; use when you only care about a specific target virus
# Default (false): full de novo assembly + optional reference-guided output on the side
reference_only: true

# Optional host genome FASTA to filter out host reads (like Virall --filter)
# When set, reads mapping to the host are removed before assembly (minimap2 + samtools).
host_genome: "/full/path/to/fatsa/file/with/sequences/to/filter/out"

# -----------------------------------------------------------------------------
# Preprocessing
# -----------------------------------------------------------------------------
# PHRED quality threshold and minimum read length after trimming
quality_phred: 30           # short reads (fastp)
quality_phred_long: 7       # long reads (fastplong)
min_read_len: 50            # short reads (fastp)
min_read_len_long: 1000     # long reads (fastplong)

# Long-read sequencing technology: "nanopore" or "pacbio". This parameter is ignored if only short reads are present
# Affects SPAdes (--nanopore vs --pacbio), Flye (--nano-raw vs --pacbio-raw), minimap2 presets
long_read_tech: "nanopore"

# Flye assembler tuning (used in hybrid and long_only strategies)
# --meta is always enabled (metagenome mode for uneven coverage)
# Minimum overlap between long reads for Flye assembly graph construction
# Lower values help recover shorter viral genomes; increase for less fragmented assemblies
flye_min_overlap: 1000
# Expected genome size hint for Flye (e.g. "10k", "30k", "150k")
# Leave null to let Flye auto-estimate (recommended for diverse metagenomes)
# Set a value if targeting a specific virus size range (e.g. "30k" for coronaviruses)
flye_genome_size: null

# Set true for Ion Torrent short reads (adds --iontorrent to SPAdes for homopolymer error correction)
iontorrent: false

# Set true to use metaviralSPAdes (--metaviral) instead of regular SPAdes
# Note: If a reference genome is also provided, --trusted-contigs takes priority
# and --metaviral is skipped (they are incompatible in SPAdes)
metaviral_mode: false

# -----------------------------------------------------------------------------
# Resources
# -----------------------------------------------------------------------------
threads: 12
memory: "24G"

# -----------------------------------------------------------------------------
# Optional minimum contig length
# -----------------------------------------------------------------------------
min_contig_len: 1000

# -----------------------------------------------------------------------------
# Single-Cell Sequencing (10x Genomics)
# -----------------------------------------------------------------------------
# Enable single-cell mode for 10x Genomics data
# When enabled, the pipeline:
#   1. Extracts cell barcodes and UMIs from R1
#   2. Pools all cells for assembly and viral discovery
#   3. Maps barcoded reads back to viral contigs
#   4. Generates per-cell viral quantification (MTX format)
single_cell_mode: false

# 10x chemistry version - determines barcode/UMI structure
# Supported values:
#   - "10x_v3" (or "10x_3prime_v3", "10x_5prime_v3"): 16bp barcode + 12bp UMI (default)
#   - "10x_v2" (or "10x_3prime_v2", "10x_5prime_v2"): 16bp barcode + 10bp UMI
#   - "10x_v1" (or "10x_3prime_v1"): 14bp barcode + 10bp UMI
sc_chemistry: "10x_v3"

# Optional: custom barcode whitelist file
# If not provided, all observed barcodes are used
sc_barcode_whitelist: null

# Minimum reads per cell to include in output matrix
# Cells with fewer reads are filtered out
sc_min_reads_per_cell: 100

# Minimum viral UMIs to classify a cell as "infected"
sc_min_viral_umis: 1
